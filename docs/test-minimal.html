<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Minimal i18n</title>
    <style>
        body { font-family: Arial; padding: 2rem; max-width: 800px; margin: 0 auto; }
        .controls { background: #f0f0f0; padding: 1rem; margin: 1rem 0; }
        button { padding: 0.75rem 1.5rem; margin: 0.5rem; font-size: 16px; cursor: pointer; }
        .demo-text { font-size: 1.5rem; margin: 2rem 0; padding: 1rem; background: #e3f2fd; }
        pre { background: #263238; color: #aed581; padding: 1rem; overflow: auto; }
    </style>
</head>
<body>
    <h1>🧪 Prueba Minimalista de i18n</h1>
    
    <div class="controls">
        <h2>Control Manual</h2>
        <p>Idioma actual: <strong id="display-lang">ES</strong></p>
        <button id="manualToggle">🔄 Cambiar Idioma</button>
    </div>

    <div class="demo-text">
        <h2 data-i18n="hero.title">Texto por defecto en español</h2>
        <p data-i18n="hero.subtitle">Subtítulo por defecto</p>
        <button data-i18n="nav.cta">Botón CTA</button>
    </div>

    <div>
        <h3>Elementos traducidos:</h3>
        <ul id="translated-list"></ul>
    </div>

    <h3>Log de consola:</h3>
    <pre id="log"></pre>

    <script>
        // Sistema de logging
        const logElement = document.getElementById('log');
        const logs = [];
        
        function log(msg) {
            const timestamp = new Date().toLocaleTimeString();
            const logMsg = `[${timestamp}] ${msg}`;
            logs.push(logMsg);
            logElement.textContent = logs.join('\n');
            console.log(logMsg);
        }

        // Variables globales
        let currentLang = 'es';
        const translationCache = {};

        // Función para obtener traducciones anidadas
        function getNestedTranslation(translations, key) {
            return key.split('.').reduce((acc, segment) => 
                (acc && acc[segment] !== undefined ? acc[segment] : undefined), translations);
        }

        // Cargar traducciones
        async function loadTranslations(lang) {
            if (translationCache[lang]) {
                log(`✅ Usando cache para ${lang}`);
                return translationCache[lang];
            }

            try {
                log(`📥 Cargando ${lang}.json...`);
                const response = await fetch(`./i18n/${lang}.json`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                translationCache[lang] = data;
                log(`✅ ${lang}.json cargado: ${Object.keys(data).length} claves`);
                return data;
            } catch (error) {
                log(`❌ Error: ${error.message}`);
                return {};
            }
        }

        // Aplicar traducciones
        function applyTranslations(translations) {
            const elements = document.querySelectorAll('[data-i18n]');
            log(`🔄 Aplicando traducciones a ${elements.length} elementos`);
            
            let count = 0;
            const listElement = document.getElementById('translated-list');
            listElement.innerHTML = '';
            
            elements.forEach((element) => {
                const key = element.getAttribute('data-i18n');
                const value = getNestedTranslation(translations, key);
                
                if (value !== undefined) {
                    // Aplicar traducción
                    if (value.includes('<')) {
                        element.innerHTML = value;
                    } else {
                        element.textContent = value;
                    }
                    
                    // Agregar a la lista
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>${key}</strong>: "${value.substring(0, 50)}${value.length > 50 ? '...' : ''}"`;
                    listElement.appendChild(li);
                    
                    count++;
                }
            });
            
            log(`✅ ${count} elementos traducidos`);
        }

        // Cambiar idioma
        async function setLanguage(lang) {
            log(`🌍 Cambiando idioma a: ${lang.toUpperCase()}`);
            const translations = await loadTranslations(lang);
            applyTranslations(translations);
            currentLang = lang;
            document.documentElement.lang = lang;
            document.getElementById('display-lang').textContent = lang.toUpperCase();
            log(`✅ Idioma cambiado exitosamente a ${lang.toUpperCase()}`);
        }

        // Event listener para el botón manual
        document.getElementById('manualToggle').addEventListener('click', () => {
            log(`🖱️ CLICK detectado en manualToggle`);
            const nextLang = currentLang === 'es' ? 'en' : 'es';
            setLanguage(nextLang);
        });

        // Inicialización
        log('🚀 Iniciando sistema i18n...');
        log(`📍 Idioma inicial: ${currentLang.toUpperCase()}`);
        setLanguage(currentLang);
    </script>
</body>
</html>
