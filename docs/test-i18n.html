<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test i18n</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }
        button {
            padding: 0.5rem 1rem;
            margin: 0.5rem;
            cursor: pointer;
            border: 1px solid #333;
            background: white;
            border-radius: 4px;
        }
        button:hover {
            background: #f0f0f0;
        }
        .results {
            background: white;
            padding: 1rem;
            margin-top: 1rem;
            border-left: 4px solid #4CAF50;
        }
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Test de Internacionalización (i18n)</h1>
    
    <div class="test-section">
        <h2>Prueba 1: Elementos con data-i18n</h2>
        <p data-i18n="hero.title">Texto por defecto</p>
        <button id="testBtn1">Cambiar a Inglés</button>
    </div>

    <div class="test-section">
        <h2>Prueba 2: Elementos con data-i18n-attr</h2>
        <button id="testBtn2" aria-label="Etiqueta inicial" data-i18n-attr="aria-label:header.langToggle">Botón de prueba</button>
    </div>

    <div class="test-section">
        <h2>Prueba 3: Cargar ambos idiomas</h2>
        <button id="loadEs">Cargar ES</button>
        <button id="loadEn">Cargar EN</button>
        <div class="results" id="results"></div>
    </div>

    <div class="test-section">
        <h2>Logs de consola</h2>
        <pre id="console-log"></pre>
    </div>

    <script>
        const consoleLog = document.getElementById('console-log');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleLog.textContent += args.join(' ') + '\n';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            consoleLog.textContent += 'ERROR: ' + args.join(' ') + '\n';
        };

        function getNestedTranslation(translations, key) {
            return key.split('.').reduce((acc, segment) => 
                (acc && acc[segment] !== undefined ? acc[segment] : undefined), translations);
        }

        async function loadTranslations(lang) {
            try {
                const url = `./i18n/${lang}.json`;
                console.log(`Cargando traducciones desde ${url}`);
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                console.log(`✓ Cargadas ${Object.keys(data).length} claves para ${lang}`);
                return data;
            } catch (error) {
                console.error(`Error cargando ${lang}:`, error);
                return {};
            }
        }

        function applyTranslations(translations) {
            let count = 0;
            document.querySelectorAll('[data-i18n]').forEach((element) => {
                const key = element.getAttribute('data-i18n');
                const value = getNestedTranslation(translations, key);
                if (value !== undefined) {
                    element.textContent = value;
                    count++;
                }
            });

            document.querySelectorAll('[data-i18n-attr]').forEach((element) => {
                const mappings = element.getAttribute('data-i18n-attr').split(';');
                mappings.forEach((mapping) => {
                    if (!mapping.trim()) return;
                    const [attrName, key] = mapping.split(':').map((item) => item.trim());
                    if (!attrName || !key) return;
                    const value = getNestedTranslation(translations, key);
                    if (value !== undefined) {
                        element.setAttribute(attrName, value);
                        count++;
                    }
                });
            });
            
            console.log(`Aplicadas ${count} traducciones`);
        }

        document.getElementById('testBtn1').addEventListener('click', async () => {
            const translations = await loadTranslations('en');
            applyTranslations(translations);
        });

        document.getElementById('loadEs').addEventListener('click', async () => {
            const translations = await loadTranslations('es');
            document.getElementById('results').innerHTML = `
                <strong>Español cargado:</strong><br>
                <code>hero.title: ${translations['hero.title']}</code><br>
                <code>header.langToggle: ${translations['header.langToggle']}</code>
            `;
            applyTranslations(translations);
        });

        document.getElementById('loadEn').addEventListener('click', async () => {
            const translations = await loadTranslations('en');
            document.getElementById('results').innerHTML = `
                <strong>English loaded:</strong><br>
                <code>hero.title: ${translations['hero.title']}</code><br>
                <code>header.langToggle: ${translations['header.langToggle']}</code>
            `;
            applyTranslations(translations);
        });

        // Auto-load Spanish on page load
        console.log('Iniciando test de i18n...');
        loadTranslations('es').then(translations => {
            applyTranslations(translations);
        });
    </script>
</body>
</html>
